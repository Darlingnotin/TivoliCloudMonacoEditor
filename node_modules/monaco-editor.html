<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>

<body style="background-color:black;">
    <input type="text" id="fileName" placeholder="Script URL" style="height: 17px;background-color:black;color: rgb(226, 226, 226);width:100%;border:1px solid grey">
    <button onclick="loadScript()" id="myButtonA" style="position:absolute;top: 1.1%;left: 93%;background-color:black;color: rgb(226, 226, 226);">Load Script</button>
    <div id="container" style="width:100%;height: 650px;border:1px solid grey"></div>
    <button onclick="saveJs()" style="background-color:black;color: rgb(226, 226, 226);">Save</button>
    <script src="monaco-editor/min/vs/loader.js"></script>
    <script>
        var importedScript;
        var editor;
        require.config({ paths: { 'vs': 'monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('container'), {
                value: [
                ].join('\n'),
                language: "javascript",
                theme: "vs-dark"
            });
        });

        var dataBeingSent = false;

        function saveJs() {
            if (!dataBeingSent) {
                dataBeingSent = true;
                getVal = editor.getValue()
                console.log(getVal);
                var fileName = document.getElementById("fileName").value;
                if (fileName == "") {
                    alert("Script Path Empty");
                } else {
                    var messageData = {
                        action: "save",
                        fileName: document.getElementById("fileName").value,
                        fileData: getVal
                    };
                    EventBridge.emitWebEvent(JSON.stringify(messageData));
                    alert(document.getElementById("fileName").value + " Saved");
                    dataBeingSent = false;
                }
            }
        }

        function loadScript() {
            var messageData = {
                action: "loadScript",
                fileName: document.getElementById("fileName").value,
            };
            EventBridge.emitWebEvent(JSON.stringify(messageData));
        }

        EventBridge.scriptEventReceived.connect(function (message) {
            var messageData = JSON.parse(message);
            if (messageData.action == "loadScriptResponse") {
                importedScript = messageData.fileData
                window.editor.getModel().setValue(importedScript);
            }
        });

    </script>

</body>

</html>