<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
</head>

<body>
    <input type="text" id="fileName" placeholder="Script URL" style="width:79%;border:1px solid grey">
    <button onclick="loadScript()">Load Script</button>
    <div id="container" style="width:100%;height: 650px;border:1px solid grey"></div>
    <button onclick="saveJs()">Save</button>
    <script src="monaco-editor/min/vs/loader.js"></script>
    <script>
        // Copyright (c) 2021 Danielle Arlington.

        // This program is free software: you can redistribute it and/or modify  
        // it under the terms of the GNU General Public License as published by  
        // the Free Software Foundation, version 3.
        // https://www.gnu.org/licenses/gpl-3.0.en.html
        
        var importedScript;
        var editor;
        require.config({ paths: { 'vs': 'monaco-editor/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('container'), {
                value: [
                ].join('\n'),
                language: "javascript"
            });
        });

        var dataBeingSent = false;

        function saveJs() {
            if (!dataBeingSent) {
                dataBeingSent = true;
                getVal = editor.getValue()
                console.log(getVal);
                var fileName = document.getElementById("fileName").value;
                if (fileName == "") {
                    alert("Script Path Empty");
                } else {
                    var messageData = {
                        action: "save",
                        fileName: document.getElementById("fileName").value,
                        fileData: getVal
                    };
                    EventBridge.emitWebEvent(JSON.stringify(messageData));
                    alert(document.getElementById("fileName").value + " Saved");
                    dataBeingSent = false;
                }
            }
        }

        function loadScript() {
            var messageData = {
                action: "loadScript",
                fileName: document.getElementById("fileName").value,
            };
            EventBridge.emitWebEvent(JSON.stringify(messageData));
        }

        EventBridge.scriptEventReceived.connect(function (message) {
            var messageData = JSON.parse(message);
            if (messageData.action == "loadScriptResponse") {
                importedScript = messageData.fileData
                window.editor.getModel().setValue(importedScript);
            }
        });

    </script>

</body>

</html>