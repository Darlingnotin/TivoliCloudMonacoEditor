<html>

<head>

</head>

<body style="background-color: rgb(56, 56, 56);">
    <h2 id="companionFiles" hidden=true
        style="color: white; padding: 10px; background-color: rgb(133, 133, 133); border-radius: 5px;">Tivoli Cloud
        Editor Companion Files</h2>
    <div id="fileList" hidden=true
        style="color: white; padding: 5px; background-color: rgb(133, 133, 133); border-radius: 5px;"></div>
    <script>
        var ws = new WebSocket("ws://localhost:888");
        var fileName;
        ws.onopen = function () {
            ws.send(JSON.stringify({
                action: "requestFileList"
            }));
        }
        ws.onmessage = function (evt) {
            messageData = JSON.parse(evt.data);
            if (messageData.action == "requestFileListResponse") {
                var fileListHtml = "";
                if (messageData.fileList.length === 0) {
                    document.getElementById("companionFiles").hidden = false;
                    document.getElementById("fileList").hidden = false;
                    document.getElementById("fileList").innerHTML = "<p style=\"font-size: 25px;\">Server Empty</p><input id=\"inputFileName\" type=\"text\" placeholder=\"File Name\"><br><button onclick=\"saveJs()\">New File</button>";
                } else {
                    for (let i = 0; i < messageData.fileList.length; i++) {
                        var fileType = messageData.fileList[i].split(".")[1];
                        if (fileType == "glb" || fileType == "gltf" || fileType == "fbx" || fileType == "obj") {
                            fileListHtml = fileListHtml + "<p style=\"font-size: 25px;\">" + messageData.fileList[i] + "<br><button onclick=\"viewModel('" + messageData.fileList[i] + "')\">View Model " + messageData.fileList[i] + "</button>";
                        } else {
                            fileListHtml = fileListHtml + "<p style=\"font-size: 25px;\">" + messageData.fileList[i] + "<br><button onclick=\"editFile('" + messageData.fileList[i] + "')\">Edit " + messageData.fileList[i] + "</button>";
                        }
                    }
                    fileListHtml = fileListHtml + "</p><input id=\"inputFileName\" type=\"text\" placeholder=\"File Name\"><br><button onclick=\"saveJs()\">New File</button>";
                    document.getElementById("companionFiles").hidden = false;
                    document.getElementById("fileList").hidden = false;
                    document.getElementById("fileList").innerHTML = fileListHtml;
                }
            } else if (messageData.action == "requestFileResponse") {
                var messageData = {
                    action: "editFile",
                    fileData: messageData.file,
                    fileName: fileName
                };
                EventBridge.emitWebEvent(JSON.stringify(messageData));
            }
        }
        function saveJs(file) {
            var fileName = document.getElementById("inputFileName").value;
            if (fileName == "") {
                return;
            } else {
                ws.send(JSON.stringify({
                    action: "saveFile",
                    fileName: fileName,
                    fileData: ""
                }));
                location.reload();
            }
        }

        function editFile(file) {
            ws.send(JSON.stringify({
                action: "requestFile",
                fileName: file
            }));
            fileName = file;
        }

        function viewModel(file) {
            var messageData = {
                action: "viewModel",
                fileName: file
            };
            EventBridge.emitWebEvent(JSON.stringify(messageData));
        }
    </script>
</body>

</html>